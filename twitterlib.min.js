// twitterlib.js (c) 2009 Remy Sharp
// Licensed under the terms of the MIT license.
(function(h,l){function B(b){var a='<li><div class="tweet">';a+='<div class="vcard"><a href="http://twitter.com/'+b.user.screen_name+'" class="url"><img style="height: 48px; width: 48px;" alt="'+b.user.name+'" class="photo fn" height="48" src="'+b.user.profile_image_url+'" width="48" /></a></div>';a+='<div class="hentry"><strong><a href="http://twitter.com/';a+=b.user.screen_name+'" ';a+='title="'+b.user.name+'">'+b.user.screen_name+"</a></strong> ";a+='<span class="entry-content">';a+=l[h].ify.clean(b.text);
a+='</span> <span class="meta entry-meta"><a href="http://twitter.com/'+b.user.screen_name;a+="/status/"+b.id+'" class="entry-date" rel="bookmark"><span class="published" title="';a+=b.created_at+'">'+twitterlib.time.datetime(b.created_at)+"</span></a>";if(b.source)a+=" <span>from "+b.source+"</span>";a+="</span></div></div></li>";return a}function v(b){w.removeChild(s.getElementById(h+b));delete r[h+b];m[h+b]=n;try{delete m[h+b]}catch(a){}}function x(b,a,d){var c=s.createElement("script"),e=null;
if(a==n)a={};o++;r[h+o]=true;m[h+o]=function(j,i){return function(f){var g=0,p=[];if(f.results){f=f.results;for(g=f.length;g--;){f[g].user={id:f[g].from_user_id,screen_name:f[g].from_user,profile_image_url:f[g].profile_image_url};f[g].source=l[h].ify.entities(f[g].source);p=f[g].created_at.split(" ");f[g].created_at=[p[0],p[2],p[1],p[4],p[5],p[3]].join(" ").replace(/,/,"")}}else if(f.length&&f[0].sender)for(g=f.length;g--;){f[g].user=f[g].sender;f[g].originalText=f[g].text;f[g].text="@"+f[g].recipient_screen_name+
" "+f[g].text}i.originalTweets=f;if(i.filter)f=y.matchTweets(f,i.filter);d.call(l[h],f,i);v(j)}}(o,a);e=b.match(/callback=(.*)/);if(e!=null&&e.length>1)m[e[1]]=m[h+o];else b+="&callback="+h+o;c.src=b;c.id=h+o;w.appendChild(c)}function z(b,a){return q[b].replace(/(\b.*?)%(.*?)(\|.*?)?%/g,function(d,c,e,j){if(j&&j.substr(1)=="remove"&&a[e]==n)return"";return c+(a[e]===n?j.substr(1):a[e])})}function t(b,a){if(typeof b=="function"){a=b;b={}}if(b===n)b={};b.page=b.page||1;b.callback=a;b.limit===0&&delete b.limit;
return b}function u(b,a,d){k={method:b,arg:a,options:d,callback:d.callback,page:d.page||1}}function C(b,a){if(a&&q[b]==n)q[b]=a;if(this[b]==n)this[b]=function(d,c,e){if(typeof d=="function"){e=d;d=""}else if(d.toString()=="[Object object]"){e=c;c=d;d=""}c=t(c,e);u(b,d,c);c[b]=c.user=d;c.search=encodeURIComponent(d);c.callback&&x(z(b,c),c,c.callback);return this};return this[b]}var o=+new Date,m=this,s=m.document,w=s.getElementsByTagName("head")[0],k={},r={},D={"&quot;":'"',"&lt;":"<","&gt;":">"},
A={search:"http://search.twitter.com/search.json?q=%search%&page=%page|1%&rpp=%limit|100%&since_id=%since|remove%",timeline:"http://twitter.com/statuses/user_timeline/%user%.json?count=%limit|200%&page=%page|1%&since_id=%since|remove%",list:"http://api.twitter.com/1/%user%/lists/%list%/statuses.json?page=%page|1%&per_page=%limit|200%&since_id=%since|remove%",favs:"http://twitter.com/favorites/%user%.json?page=%page|1%"},q=A,n,E=function(){return{entities:function(b){return b.replace(/(&[a-z0-9]+;)/g,
function(a){return D[a]})},link:function(b){return b.replace(/[a-z]+:\/\/[a-z0-9-_]+\.[a-z0-9-_:~\+#%&\?\/.=]+[^:\.,\)\s*$]/ig,function(a){return'<a href="'+a+'">'+(a.length>25?a.substr(0,24)+"...":a)+"</a>"})},at:function(b){return b.replace(/(^|[^\w]+)\@([a-zA-Z0-9_]{1,15}(\/[a-zA-Z0-9-_]+)*)/g,function(a,d,c){return d+'@<a href="http://twitter.com/'+c+'">'+c+"</a>"})},hash:function(b){return b.replace(/(^|[^&\w'"]+)\#([a-zA-Z0-9_]+)/g,function(a,d,c){return d+'#<a href="http://search.twitter.com/search?q=%23'+
c+'">'+c+"</a>"})},clean:function(b){return this.hash(this.at(this.link(b)))}}}(),F=function(){var b=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return{time:function(a){var d=a.getHours();a=a.getMinutes()+"";var c="AM";if(d==0)d=12;else if(d==12)c="PM";else if(d>12){d-=12;c="PM"}if(a.length==1)a="0"+a;return d+":"+a+" "+c},date:function(a){a.toDateString().split(/ /);var d=b[a.getMonth()],c=a.getDate()+"",e=~~c;a=a.getFullYear();var j=(new Date).getFullYear(),i="th";
if(e%10==1&&c.substr(0,1)!="1")i="st";else if(e%10==2&&c.substr(0,1)!="1")i="nd";else if(e%10==3&&c.substr(0,1)!="1")i="rd";if(c.substr(0,1)=="0")c=c.substr(1);return d+" "+c+i+(j!=a?", "+a:"")},datetime:function(a){a=a.split(" ");a=new Date(Date.parse(a[1]+" "+a[2]+", "+a[5]+" "+a[3]));return this.time(a)+" "+this.date(a)},relative:function(a){var d=a.split(" "),c=Date.parse(d[1]+" "+d[2]+", "+d[5]+" "+d[3]);d=new Date(c);var e=arguments.length>1?arguments[1]:new Date;c=~~((e.getTime()-c)/1E3);var j=
"";c+=e.getTimezoneOffset()*60;return j=c<5?"less than 5 seconds ago":c<30?"half a minute ago":c<60?"less than a minute ago":c<120?"1 minute ago":c<2700?(~~(c/60)).toString()+" minutes ago":c<10800?"about 1 hour ago":c<86400?"about "+(~~(c/3600)).toString()+" hours ago":c<172800?this.time(d)+" yesterday":this.time(d)+" "+this.date(d)}}}(),y=function(){return{match:function(b,a){var d=0,c="",e=b.text.toLowerCase();if(typeof a=="string")a=this.format(a);if(a.not.length){for(d=0;d<a.not.length;d++)if(e.indexOf(a.not[d])!==
-1)return false;if(!a.and.length&&!a.or.length)return true}if(a.and.length)for(d=0;d<a.and.length;d++){c=a.and[d];if(c.substr(0,3)==="to:"){if(!RegExp("^@"+c.substr(3)).test(e))return false}else if(c.substr(0,5)=="from:"){if(b.user.screen_name!==c.substr(5))return false}else if(e.indexOf(c)===-1)return false}if(a.or.length)for(d=0;d<a.or.length;d++){c=a.or[d];if(c.substr(0,3)==="to:"){if(RegExp("^@"+c.substr(3)).test(e))return true}else if(c.substr(0,5)=="from:"){if(b.user.screen_name===c.substr(5))return true}else if(e.indexOf(a.or[d])!==
-1)return true}else if(a.and.length)return true;return false},format:function(b){var a=[],d=[],c=[],e=0,j=[];b.replace(/(-?["'](.*?)["']|\S+\b)/g,function(i){var f=false;if(i.substr(0,1)=="-")f=true;i=i.replace(/["']+|["']+$/g,"");f?j.push(i.substr(1).toLowerCase()):a.push(i)});for(e=0;e<a.length;e++)if(a[e]=="OR"&&a[e+1]){d.push(a[e-1].toLowerCase());d.push(a[e+1].toLowerCase());e++;c.pop()}else c.push(a[e].toLowerCase());return{or:d,and:c,not:j}},matchTweets:function(b,a,d){var c=[],e=0;if(typeof a==
"string")a=this.format(a);for(e=0;e<b.length;e++)this.match(b[e],a,d)&&c.push(b[e]);return c}}}();l[h]={custom:C,status:function(b,a,d){a=t(a,d);a.limit=1;u("status",b,a);return this.timeline(b,a,a.callback)},list:function(b,a,d){var c=b.split("/");a=t(a,d);u("list",b,a);a.user=c[0];a.list=c[1];a.callback&&x(z("list",a),a,a.callback);return this},next:function(){if(k.method){k.page++;k.options.page=k.page;this[k.method](k.arg,k.options,k.callback)}return this},time:F,ify:E,filter:y,cancel:function(){for(var b in r)m[b]=
function(){return function(a){v(a)}}(b.replace(h,""));r={};return this},reset:function(){q=A;k.method=""},render:B,debug:function(b){for(var a in b)q[a]=b[a];return this}};l[h].custom("search");l[h].custom("timeline");l[h].custom("favs")})("twitterlib",this);
